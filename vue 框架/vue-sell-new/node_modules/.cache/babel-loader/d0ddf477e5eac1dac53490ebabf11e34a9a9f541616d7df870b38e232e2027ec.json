{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { getGoods } from '@/api';\nimport SupportIcon from '@/components/support-icon/Support-icon.vue';\nimport BScroll from '@better-scroll/core';\nexport default {\n  components: {\n    SupportIcon: SupportIcon\n  },\n  data: function data() {\n    return {\n      goods: [],\n      // currentIndex: 0,\n      foodsScroll: {},\n      //用来代表被BScroll修饰的Dom结构\n      scrollY: 0,\n      foodList: [],\n      //用来装所有的菜系dom结构\n      listHeight: [] //所有菜系Dom的高度\n    };\n  },\n  created: function created() {\n    var _this = this;\n    // 获取商品数据\n    getGoods().then(function (res) {\n      console.log(res);\n      _this.goods = res;\n      _this.$nextTick(function () {\n        // $nextTick里面的回调会在页面加载完毕之后才执行 $是vue自带的方法\n        _this.betterScroll();\n        _this._calculateHeight(); //Dom加载完毕读取\n      });\n    });\n  },\n  computed: {\n    currentIndex: function currentIndex() {\n      //随着右侧滚动this.scrollY返回不同的下标\n      for (var i = 0; i < this.listHeight.length; i++) {\n        var h1 = this.listHeight[i];\n        var h2 = this.listHeight[i + 1];\n        if (!h2 || this.scrollY >= h1 && this.scrollY < h2) {\n          return i;\n        }\n      }\n      return 0;\n    }\n  },\n  methods: {\n    betterScroll: function betterScroll() {\n      var _this2 = this;\n      // 获取到menu-wrapper的dom结构\n      // $官方自带的\n      new BScroll(this.$refs.menuWrapper, {\n        click: true\n      });\n      // 被BScroll修饰之后的dom结构\n      this.foodsScroll = new BScroll(this.$refs.foodsWrapper, {\n        // 默认把所有点击事件干掉了 click:true 强行添加一个点击事件 \n        click: true,\n        scrollY: true,\n        probeType: 3\n      });\n      this.foodList = this.$refs.foodList;\n\n      // 给右侧监听上了滚动事件\n      this.foodsScroll.on('scroll', function (pos) {\n        console.log(Math.round(Math.abs(pos.y)));\n        _this2.scrollY = Math.round(Math.abs(pos.y));\n      });\n    },\n    _calculateHeight: function _calculateHeight() {\n      var _this3 = this;\n      //计算高度\n      var height = 0;\n      this.listHeight.push(height);\n      this.foodList.forEach(function (li) {\n        // 原生js获取一个li的高读，ofset会把高度也算道内\n        height += li.clientHeight;\n        _this3.listHeight.push(height);\n      });\n      console.log(this.listHeight);\n    },\n    selectMenu: function selectMenu(i) {\n      // console.log(i);\n      this.currentIndex = i;\n      this.foodsScroll.scrollToElement(this.$refs.foodList[i], 1000);\n    }\n  }\n};","map":{"version":3,"names":["getGoods","SupportIcon","BScroll","components","data","goods","foodsScroll","scrollY","foodList","listHeight","created","_this","then","res","console","log","$nextTick","betterScroll","_calculateHeight","computed","currentIndex","i","length","h1","h2","methods","_this2","$refs","menuWrapper","click","foodsWrapper","probeType","on","pos","Math","round","abs","y","_this3","height","push","forEach","li","clientHeight","selectMenu","scrollToElement"],"sources":["C:\\Users\\www16\\Desktop\\培训\\codespace\\vue 框架\\vue-sell-new\\src\\views\\goods\\index.vue"],"sourcesContent":["<template>\n  <div class=\"goods\">\n    <div class=\"goods-content\">\n      <div class=\"menu-wrapper\" ref=\"menuWrapper\">\n        <ul>\n          <li \n            class=\"menu-item\" \n            :class=\"{'current' : currentIndex === index}\"\n            v-for=\"(item, index) in goods\" \n            :key=\"index\"\n            @click=\"selectMenu(index)\"\n          >\n            <span class=\"text\">\n              <SupportIcon size=\"3\" :type=\"item.type\" v-if=\"item.type >= 0\"/>\n              {{item.name}}\n            </span>\n          </li>\n        </ul>\n      </div>  \n      <!-- ref给Dom结构打一个标记 -->\n      <div class=\"foods-wrapper\" ref=\"foodsWrapper\">\n        <ul>\n          <!-- 一个菜系 -->\n          <li class=\"food-list\" v-for=\"(item,index) in goods\" :key=\"index\" ref=\"foodList\">\n              <h1 class=\"title\">{{ item.name }}</h1>\n              <!-- 一道道菜 -->\n              <ul>\n                <li class=\"food-item\"  v-for=\"(item2 ,index2) in item.foods\" :key=\"index2\" >\n                  <div class=\"pic\">\n                    <img :src=\"item2.image\" alt=\"\">\n                  </div>\n                  <div class=\"content\">\n\n                    <h2 class=\"name\">{{ item2.name }}</h2>\n\n                    <p class=\"desc\">{{ item2.description }}</p>\n\n                    <div class=\"extra\">\n                      <span class=\"count\">月售{{ item2.sellcout }}份</span>\n                      <span>好评率{{item2.rating}}%</span>\n                    </div>\n\n                    <div class=\"price\">\n                      <span class=\"now\">￥{{ item2.price  }}</span>\n                      <span class=\"old\" v-if=\" item2.oldPrice \">￥{{ item2.oldPrice }}</span>\n                    </div>\n                    <!-- + -->\n                  </div>\n                </li>\n              </ul>\n\n          </li>\n        </ul>\n      </div>\n    </div>\n    \n    <div class=\"cart-wrapper\">购物车</div>\n  </div>\n</template>\n\n<script>\nimport { getGoods } from '@/api'\nimport SupportIcon from '@/components/support-icon/Support-icon.vue'\nimport BScroll from '@better-scroll/core'\n\nexport default {\n  components: {\n    SupportIcon\n  },\n  data() {\n    return {\n      goods: [],\n      // currentIndex: 0,\n      foodsScroll:{},//用来代表被BScroll修饰的Dom结构\n      scrollY:0,\n      foodList:[],//用来装所有的菜系dom结构\n      listHeight:[]//所有菜系Dom的高度\n    }\n  },\n  created() {\n    // 获取商品数据\n    getGoods().then(res => {\n      console.log(res);\n      this.goods = res\n      \n      this.$nextTick(() => { // $nextTick里面的回调会在页面加载完毕之后才执行 $是vue自带的方法\n        this.betterScroll()\n        this._calculateHeight()//Dom加载完毕读取\n      })\n    })\n  },\n  computed:{\n    currentIndex(){\n      //随着右侧滚动this.scrollY返回不同的下标\n      for(let i = 0; i < this.listHeight.length; i++){\n        const h1 = this.listHeight[i]\n        const h2 = this.listHeight[i + 1]\n        if(!h2||(this.scrollY>=h1&&this.scrollY<h2)){\n          return i\n        }\n      }\n      return 0\n    }\n  },\n  methods: {\n    betterScroll() {\n      // 获取到menu-wrapper的dom结构\n      // $官方自带的\n      new BScroll(this.$refs.menuWrapper, {\n        click: true,\n        \n      })\n      // 被BScroll修饰之后的dom结构\n      this.foodsScroll=new BScroll(this.$refs.foodsWrapper,{\n        // 默认把所有点击事件干掉了 click:true 强行添加一个点击事件 \n        click:true,\n        scrollY:true,\n        probeType:3\n      })\n\n      this.foodList= this.$refs.foodList\n\n      // 给右侧监听上了滚动事件\n      this.foodsScroll.on('scroll',pos => {\n        console.log(Math.round(Math.abs(pos.y)));\n        this.scrollY=Math.round(Math.abs(pos.y))\n        \n      }) \n\n    },\n    _calculateHeight(){\n      //计算高度\n      let height= 0\n      this.listHeight.push(height)\n      this.foodList.forEach(li => {\n        // 原生js获取一个li的高读，ofset会把高度也算道内\n        height+= li.clientHeight\n        this.listHeight.push(height)\n      })\n      console.log(this.listHeight);\n    },\n    selectMenu(i) {\n      // console.log(i);\n      this.currentIndex = i\n      this.foodsScroll.scrollToElement(this.$refs.foodList[i],1000)\n\n\n    },\n\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n@import '@/common/style/variable.less';\n.goods{\n  position: absolute;\n  width: 100%;\n  bottom: 46px;\n  top: 177px;\n  overflow: hidden;\n  &-content{\n    display: flex;\n    height: 100%;\n    .menu-wrapper{\n      flex: 0 0 80px;\n      background: @color-background-ssss;\n      .menu-item{\n        padding: 0 14px;\n        font-size: @fontsize-small;\n        height: 54px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        &.current{\n          background: #fff;\n          font-weight: 700;\n        }\n      }\n    }\n    .foods-wrapper{\n      flex: 1;\n      .title{\n        height: 26px;\n        line-height: 26px;\n        font-size: @fontsize-small;\n        color: rgb(147, 153, 159);\n        background: @color-background-ssss;\n        padding-left: 14px;\n        border-left:2px solid #d9dde1;\n      }\n      .food-item{\n        display: flex;\n        padding:18px ;\n        .pic{\n          flex: 0 0 57px;\n          margin-right: 10px;\n          img{\n            width: 100%;\n          }\n        }\n        .content{\n          flex: 1;\n          .name{\n            font-size: @fontsize-medium;\n            color: rgb(7, 17, 27);\n            margin: 2px 0 8px 0;\n          }\n          .desc, .extra{\n            font-size: @fontsize-small-s;\n            color: rgb(147, 153, 159);\n            margin-bottom: 8px;\n            line-height: 10px;\n            .count{\n              margin-right: 12px;\n            }\n          }\n          .price{\n            // 最大七百\n            font-weight: 700;\n            line-height: 10px;\n            .now{\n              color:@color-red ;\n              font-size: @fontsize-medium;\n              margin-right: 8px;\n            }\n            .old{\n              font-size:@fontsize-small-s ;\n              color: rgb(147, 153, 159);\n              // 拦腰下划线\n              text-decoration: line-through;\n            }\n          }\n        }\n\n      }\n    }\n  }\n\n  .cart-wrapper{\n    position: fixed;\n    bottom: 0;\n    width: 100%;\n    height: 48px;\n    background: #aaa;\n  }\n}\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}